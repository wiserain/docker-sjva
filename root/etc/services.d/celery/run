#!/usr/bin/with-contenv bash

. /app/export.sh

if [ "${USE_CELERY:-true}" == "true" ]; then
	echo "[services.d] running celery with ${CELERY_WORKER_COUNT:-2} workers"	
	# # as root
	# export C_FORCE_ROOT='true'
	# exec celery -A sjva3.celery \
	# 	worker -c${CELERY_WORKER_COUNT} --loglevel=info

	# as root but with uid gid
	exec celery -A sjva3.celery \
		worker -c${CELERY_WORKER_COUNT:-2} --loglevel=info --uid=${PUID:-911} --gid=${PGID:-911}
fi

# dummy to demonize this service run
while true; do sleep 1h; done
